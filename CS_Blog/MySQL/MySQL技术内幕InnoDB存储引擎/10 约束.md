# 一、约束的作用

约束的作用：用来保证存储`数据的完整性`

数据完整性的三种表现形式：

1. `实体完整性`：保证表中只有一个主键。通过**主键约束、唯一键约束**来保证
2. `域完整性`：保证每一列数据值满足特定条件。通过**外键约束、触发器、default约束、选择合适的数据类型**来保证
3. `参照完整性`：保证两张表之间的关系。通过**外键约束、触发器**来保证

对于 InnoDB 存储引擎而言，提供了以下几种约束：

* Primary Key 约束
* Unique Key 约束
* Foreign Key 约束
* Default
* NOT NULL

# 二、约束的创建及查找

约束创建的两种方式：

1. 表建立时，对指定列进行约束定义
2. 表建立完成后，使用 alter table 命令进行创建约束

## 1. 设置主键约束

* 如果主键是单个字段：直接在该字段的数据类型后面加上 `primary key` 即可

语法规则：

```sql
字段名 数据类型 primary key
```

例如：

```sql
student_no char(11) primary key,
```

* 如果主键是多个字段

语法规则：

```sql
primary key(字段名1, 字段名2, ...)
```

例如：

```sql
create table nowadays(
	t1 datetime,
    t1 timestamp,
    primary key(t1, t2)
);
```

## 2. 设置非空约束

如果某个字段在需求中不允许其为空，则可以对该字段进行非空约束.

语法规则：

```sql
字段名 数据类型 not null
```

例如：不允许 student_name 字段为空

```sql
student_name varchar(11) not null
```

## 3. 设置唯一性约束

如果某个字段在需求中不允许重复，即不允许两个记录中同一个字段的值相同，则可以对该字段进行唯一性约束。

语法规则：

```sql
字段名 数据类型 unique
```

例如：对 class_name 字段设置为非空约束

```sql
class_name char(20) not null unique
```

## 4. 设置默认值约束

语法规则：

```sql
字段名 数据类型 default 默认值
```

例如：设置 status 字段默认值为 '未审核'

```sql
status char(6) default '未审核'
```



## 5. 设置外键约束

给 A 表的字段 a 设置的外键必须参照 B 表的主键 b，其中 A 表称为子表，B 表称为父表，其中 a 字段的取值要么为 NULL，要么取自 B 表的主键 b 中的值

语法规则：给 A 表设置外键

```sql
constraint 约束名称 foreign key (a) references B(b) [on delete 级联选项] [on update 级联选项]
```

 4 中级联选项的含义：

| 级联选项  | 含义                                                         |
| --------- | ------------------------------------------------------------ |
| cascade   | 会自动删除或修改子表的外键值                                 |
| set null  | 会自动删除或修改子表的外键值为NULL                           |
| no action | 如果删除或修改父表的记录，子表中仍然有该记录的字段值，则删除或修改父表操作失败 |
| restrict  | 与 no action 相同，且为级联操作的默认选项                    |

例如：给 Student 表的字段 class_no 设置外键参照 Class 表的字段 class_no

```sql
constraint student_class_fk foreign key(class_no) references Class(class_no)
```

## 6. 查看表的约束

如果我们按照如下创建了两个表，我们如何查看其中 Student 表的约束呢？

```sql
MySQL [gongruiyang]> create table Class(
    -> class_no char(11) primary key,
    -> class_name varchar(11) not null)engine=innodb;
Query OK, 0 rows affected (0.05 sec)

MySQL [gongruiyang]> create table Student(
    -> student_no char(11) primary key,
    -> student_name varchar(11) not null,
    -> class_no char(11) not null,
    -> constraint student_class_fk foreign key(class_no) references Class(class_no),    -> student_personal_id char(17) not null unique)engine=innodb;
Query OK, 0 rows affected (0.05 sec)
```

查看表的约束有如下两种方式：

1. 使用 `information_schema.table_constraints`查看某个表的所有的**约束名称**和**约束类型**

```sql
MySQL [gongruiyang]> select constraint_name, constraint_type from information_schema.table_constraints where table_name = 'Student';
+---------------------+-----------------+
| constraint_name     | constraint_type |
+---------------------+-----------------+
| PRIMARY             | PRIMARY KEY     |
| student_personal_id | UNIQUE          |
| student_class_fk    | FOREIGN KEY     |
+---------------------+-----------------+
3 rows in set (0.01 sec)
```

2. 使用`show index from`命令

```sql
MySQL [gongruiyang]> show index from Student\G;
*************************** 1. row ***************************
        Table: student
   Non_unique: 0
     Key_name: PRIMARY
 Seq_in_index: 1
  Column_name: student_no
    Collation: A
  Cardinality: 0
     Sub_part: NULL
       Packed: NULL
         Null: 
   Index_type: BTREE
      Comment: 
Index_comment: 
*************************** 2. row ***************************
        Table: student
   Non_unique: 0
     Key_name: student_personal_id
 Seq_in_index: 1
  Column_name: student_personal_id
    Collation: A
  Cardinality: 0
     Sub_part: NULL
       Packed: NULL
         Null: 
   Index_type: BTREE
      Comment: 
Index_comment: 
*************************** 3. row ***************************
        Table: student
   Non_unique: 1
     Key_name: student_class_fk
 Seq_in_index: 1
  Column_name: class_no
    Collation: A
  Cardinality: 0
     Sub_part: NULL
       Packed: NULL
         Null: 
   Index_type: BTREE
      Comment: 
Index_comment: 
3 rows in set (0.00 sec)
```



# 三、约束与索引的区别

primary key 、 unique key 、foreign key 即是索引又是约束，用户创建了一个索引就是创建了一个约束，但是他们的概念还是不一样的，约束是一个逻辑概念，就是用来保证数据的完整性，而索引更偏重于物理概念，代表着在数据库的物理存储方式。





